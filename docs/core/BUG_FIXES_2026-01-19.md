# Bug ä¿®å¤è®°å½• - 2026-01-19

**åˆ›å»ºæ—¥æœŸ**: 2026-01-19
**çŠ¶æ€**: âœ… å·²å®Œæˆ
**å½±å“èŒƒå›´**: æ•°æ®æ‘„å–ç®¡é“ (Ingestion Pipeline)
**ä¸¥é‡çº§åˆ«**: ğŸ”´ P0 - é˜»å¡æ€§ Bug (å¯¼è‡´æ•°æ®æ— æ³•æ­£ç¡®æ’å…¥)

---

## ğŸ“‹ ç›®å½•

- [èƒŒæ™¯](#èƒŒæ™¯)
- [Bug 1: DateTime Kind=Unspecified](#bug-1-datetime-kindunspecified)
- [Bug 2: Duplicate Key Violation](#bug-2-duplicate-key-violation)
- [ä¿®å¤éªŒè¯](#ä¿®å¤éªŒè¯)
- [ç›¸å…³æ–‡æ¡£](#ç›¸å…³æ–‡æ¡£)

---

## èƒŒæ™¯

### é—®é¢˜å‘ç°

**æ—¶é—´**: 2026-01-19
**è§¦å‘**: ç”¨æˆ·å›å½’é¡¹ç›®,æ£€æŸ¥éƒ¨ç½²çŠ¶æ€æ—¶å‘ç°å†…å­˜å¼‚å¸¸å¢é•¿

**å†…å­˜ä½¿ç”¨è¶‹åŠ¿**:
| æ—¶é—´ | å·²ç”¨å†…å­˜ | ä½¿ç”¨ç‡ | å¯ç”¨å†…å­˜ | çŠ¶æ€ |
|------|---------|--------|---------|------|
| 2026-01-10 (è¿ç§»å) | 654 MB | 77% | 193 MB | âœ… å¥åº· |
| 2026-01-19 (å‘ç°æ—¶) | 780 MB | 92% | 65 MB | âš ï¸ å¼‚å¸¸ |
| å¢é•¿ | +126 MB | +15% | -128 MB | ğŸ”´ é—®é¢˜ |

**å¢é•¿é€Ÿåº¦**: 126 MB / 9 å¤© = **14 MB/å¤©**

### æ ¹æœ¬åŸå› åˆ†æ

é€šè¿‡æ—¥å¿—åˆ†æå‘ç°ä¸¤ä¸ªå…³é”®é”™è¯¯ä¸æ–­å‡ºç°,å¯¼è‡´:
1. âŒ Hangfire ä»»åŠ¡å¤±è´¥åä¸æ–­é‡è¯•
2. âŒ å¼‚å¸¸å¯¹è±¡å †ç§¯åœ¨å†…å­˜ä¸­
3. âŒ é‡è¯•é˜Ÿåˆ—æŒç»­å¢é•¿

**æ—¥å¿—ä¸­çš„é”™è¯¯**:
```
Error processing job: Pipefitters FIFO
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes.
 ---> Npgsql.PostgresException (0x80004005): 23505: duplicate key value violates unique constraint "uq_source_external_id"

Error processing job: Plumber (Permanent & Casual Opportunities)
Microsoft.EntityFrameworkCore.DbUpdateException: An error occurred while saving the entity changes.
 ---> System.ArgumentException: Cannot write DateTime with Kind=Unspecified to PostgreSQL type 'timestamp with time zone'
```

**å½±å“èŒƒå›´**:
- 65 ä¸ª Hangfire å®šæ—¶ä»»åŠ¡å—å½±å“
- æ•°æ®æ’å…¥æˆåŠŸç‡ä¸‹é™
- å†…å­˜æŒç»­å¢é•¿æœ€ç»ˆå¯¼è‡´ OOM é£é™©

---

## Bug 1: DateTime Kind=Unspecified

### é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**:
```
System.ArgumentException: Cannot write DateTime with Kind=Unspecified to PostgreSQL type 'timestamp with time zone', only UTC is supported.
Note that it's not possible to mix DateTimes with different Kinds in an array, range, or multirange. (Parameter 'value')
```

**æ ¹æœ¬åŸå› **:
- Python çˆ¬è™« API ä½¿ç”¨ `datetime.fromisoformat()` è§£ææ—¶é—´å­—ç¬¦ä¸²
- è¯¥æ–¹æ³•è¿”å›çš„ datetime å¯¹è±¡å¯èƒ½ç¼ºå°‘æ—¶åŒºä¿¡æ¯ (timezone-naive)
- Pydantic åºåˆ—åŒ–ä¸º JSON å,ä¼ é€’ç»™ .NET API
- .NET ååºåˆ—åŒ–æ—¶å¾—åˆ° `DateTimeKind.Unspecified`
- PostgreSQL è¦æ±‚ `timestamp with time zone` ç±»å‹å¿…é¡»æ˜¯ UTC

**æ•°æ®æµç¨‹**:
```
Python çˆ¬è™«
  â†“ datetime.fromisoformat("2026-01-15T08:30:00Z")
  â†“ â†’ DateTime(kind=Unspecified)  âŒ é—®é¢˜ç‚¹
  â†“ JSON åºåˆ—åŒ–
.NET API æ¥æ”¶
  â†“ ååºåˆ—åŒ–ä¸º DateTime(kind=Unspecified)
  â†“ å°è¯•æ’å…¥ PostgreSQL
  â†“ âŒ é”™è¯¯: Cannot write DateTime with Kind=Unspecified
```

### å—å½±å“æ–‡ä»¶

1. `scrape-api/app/adapters/seek_adapter.py` - SEEK å¹³å°é€‚é…å™¨
2. `scrape-api/app/adapters/indeed_adapter.py` - Indeed å¹³å°é€‚é…å™¨

### ä¿®å¤æ–¹æ¡ˆ

**åŸåˆ™**: ç¡®ä¿æ‰€æœ‰ datetime å¯¹è±¡åœ¨ Python ç«¯å°±æ˜¯ **UTC timezone-aware**

#### ä¿®å¤ä»£ç  (SEEK Adapter)

**æ–‡ä»¶**: [scrape-api/app/adapters/seek_adapter.py:401-425](../../scrape-api/app/adapters/seek_adapter.py#L401-L425)

**ä¿®æ”¹å‰**:
```python
posted_at = None
if created_at:
    if isinstance(created_at, str):
        try:
            posted_at = datetime.fromisoformat(created_at.replace('Z', '+00:00'))
        except ValueError as e:
            logger.warning(f"æ—¥æœŸè§£æå¤±è´¥: {created_at}, é”™è¯¯: {e}")
            posted_at = None
    elif isinstance(created_at, datetime):
        posted_at = created_at
```

**ä¿®æ”¹å**:
```python
from datetime import datetime, timezone  # æ·»åŠ  timezone å¯¼å…¥

posted_at = None
if created_at:
    if isinstance(created_at, str):
        try:
            # ğŸ”§ FIX: è§£æ ISO æ ¼å¼æ—¶é—´å­—ç¬¦ä¸²å¹¶è½¬æ¢ä¸º UTC
            dt = datetime.fromisoformat(created_at.replace('Z', '+00:00'))

            # ç¡®ä¿æ˜¯ timezone-aware ä¸”ä¸º UTC
            if dt.tzinfo is None:
                # å¦‚æœæ˜¯ naive datetime,æ·»åŠ  UTC æ—¶åŒº
                posted_at = dt.replace(tzinfo=timezone.utc)
            else:
                # å¦‚æœæœ‰æ—¶åŒº,è½¬æ¢åˆ° UTC
                posted_at = dt.astimezone(timezone.utc)
        except ValueError as e:
            logger.warning(f"èŒä½ {job_id} æ—¥æœŸè§£æå¤±è´¥: {created_at}, é”™è¯¯: {e}")
            posted_at = None
    elif isinstance(created_at, datetime):
        # ğŸ”§ FIX: ç¡®ä¿å·²æœ‰çš„ datetime ä¹Ÿæ˜¯ timezone-aware UTC
        if created_at.tzinfo is None:
            posted_at = created_at.replace(tzinfo=timezone.utc)
        else:
            posted_at = created_at.astimezone(timezone.utc)
```

**å…³é”®ä¿®æ”¹**:
1. âœ… å¯¼å…¥ `timezone` æ¨¡å—
2. âœ… æ£€æŸ¥ `dt.tzinfo is None` (timezone-naive)
3. âœ… ä½¿ç”¨ `replace(tzinfo=timezone.utc)` æ·»åŠ  UTC æ—¶åŒº
4. âœ… ä½¿ç”¨ `astimezone(timezone.utc)` è½¬æ¢åˆ° UTC
5. âœ… åŒæ ·å¤„ç† `isinstance(created_at, datetime)` åˆ†æ”¯

#### ä¿®å¤ä»£ç  (Indeed Adapter)

**æ–‡ä»¶**: [scrape-api/app/adapters/indeed_adapter.py:164-185](../../scrape-api/app/adapters/indeed_adapter.py#L164-L185)

**ä¿®æ”¹å†…å®¹**: ä¸ SEEK Adapter ç›¸åŒçš„é€»è¾‘

### æµ‹è¯•éªŒè¯

#### å•å…ƒæµ‹è¯•

**æ–‡ä»¶**: [scrape-api/tests/test_datetime_fix.py](../../scrape-api/tests/test_datetime_fix.py)

**æµ‹è¯•ç”¨ä¾‹**:
```python
def test_datetime_with_timezone_conversion():
    """æµ‹è¯• datetime è½¬æ¢ä¸º UTC timezone-aware"""
    date_str = "2026-01-15T08:30:00Z"
    dt = datetime.fromisoformat(date_str.replace('Z', '+00:00'))

    if dt.tzinfo is None:
        posted_at = dt.replace(tzinfo=timezone.utc)
    else:
        posted_at = dt.astimezone(timezone.utc)

    assert posted_at.tzinfo is not None, "DateTime å¿…é¡»æ˜¯ timezone-aware"
    assert posted_at.tzinfo == timezone.utc, "DateTime å¿…é¡»æ˜¯ UTC"
    assert posted_at.tzname() == 'UTC', "Timezone name å¿…é¡»æ˜¯ UTC"
```

**æµ‹è¯•ç»“æœ**: âœ… 4/4 æµ‹è¯•é€šè¿‡

#### é€‚é…å™¨æµ‹è¯•

**æ–‡ä»¶**: [scrape-api/tests/test_adapter_datetime.py](../../scrape-api/tests/test_adapter_datetime.py)

**æµ‹è¯•åœºæ™¯**:
1. âœ… SEEK adapter è§£æå¸¦æ—¶åŒºçš„ ISO 8601 å­—ç¬¦ä¸²
2. âœ… Indeed adapter è§£æå„ç§æ—¶é—´æ ¼å¼
3. âœ… Pydantic åºåˆ—åŒ– timezone-aware datetime

**æµ‹è¯•ç»“æœ**: âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡

### æäº¤è®°å½•

**Commit**: `f8e0126`
**Message**: "Fix critical bugs: DateTime Kind and duplicate data insertion"

**ä¿®æ”¹æ–‡ä»¶**:
- `scrape-api/app/adapters/seek_adapter.py`
- `scrape-api/app/adapters/indeed_adapter.py`

---

## Bug 2: Duplicate Key Violation

### é—®é¢˜æè¿°

**é”™è¯¯ä¿¡æ¯**:
```
Npgsql.PostgresException (0x80004005): 23505: duplicate key value violates unique constraint "uq_source_external_id"
DETAIL: Detail redacted as it may contain sensitive data.
```

**æ ¹æœ¬åŸå› **:
- æ•°æ®åº“æœ‰å”¯ä¸€çº¦æŸ: `uq_source_external_id` on `(source, source_id)`
- `IngestionPipeline.cs` åªæ£€æŸ¥äº† `fingerprint` å»é‡
- æ²¡æœ‰æ£€æŸ¥ `(source, source_id)` ç»„åˆ
- å½“åŒä¸€ä¸ªèŒä½å†æ¬¡çˆ¬å–æ—¶,`source_id` ç›¸åŒä½† `fingerprint` å¯èƒ½ä¸åŒ (å†…å®¹å¾®è°ƒ)
- å¯¼è‡´å°è¯•æ’å…¥é‡å¤çš„ `(source, source_id)`,è¿åå”¯ä¸€çº¦æŸ

**å»é‡é€»è¾‘ç¼ºé™·**:
```csharp
// âŒ åŸæ¥çš„ä»£ç  - åªæ£€æŸ¥ fingerprint
var existingJob = await _jobRepository.GetByFingerprintAsync(job.Fingerprint, cancellationToken);

if (existingJob == null)
{
    // æ’å…¥æ–°èŒä½
    await _jobRepository.InsertAsync(job, cancellationToken);
}
```

**é—®é¢˜åœºæ™¯**:
1. ç¬¬ä¸€æ¬¡çˆ¬å–: `source=seek, source_id=abc123, fingerprint=xyz`
2. æ•°æ®åº“æ’å…¥æˆåŠŸ
3. ç¬¬äºŒæ¬¡çˆ¬å–: `source=seek, source_id=abc123, fingerprint=xyz2` (å†…å®¹ç•¥æœ‰å˜åŒ–)
4. `GetByFingerprintAsync("xyz2")` â†’ è¿”å› null (å› ä¸º fingerprint ä¸åŒ)
5. å°è¯•æ’å…¥ â†’ âŒ è¿å `uq_source_external_id` çº¦æŸ

### å—å½±å“æ–‡ä»¶

1. `src/JobIntel.Ingest/Services/IngestionPipeline.cs` - æ‘„å–ç®¡é“
2. `src/JobIntel.Core/Interfaces/IJobRepository.cs` - Repository æ¥å£
3. `src/JobIntel.Infrastructure/Repositories/JobRepository.cs` - Repository å®ç°

### ä¿®å¤æ–¹æ¡ˆ

**åŸåˆ™**: **å…ˆæ£€æŸ¥ `(source, source_id)`,å†æ£€æŸ¥ `fingerprint`**

#### 1. æ·»åŠ  GetBySourceIdAsync æ–¹æ³•

**æ–‡ä»¶**: [src/JobIntel.Core/Interfaces/IJobRepository.cs:16](../../src/JobIntel.Core/Interfaces/IJobRepository.cs#L16)

```csharp
/// <summary>
/// Get job by source and source ID
/// </summary>
Task<JobPosting?> GetBySourceIdAsync(string source, string sourceId, CancellationToken cancellationToken = default);
```

**æ–‡ä»¶**: [src/JobIntel.Infrastructure/Repositories/JobRepository.cs:38-42](../../src/JobIntel.Infrastructure/Repositories/JobRepository.cs#L38-L42)

```csharp
public async Task<JobPosting?> GetBySourceIdAsync(string source, string sourceId, CancellationToken cancellationToken = default)
{
    return await _context.JobPostings
        .FirstOrDefaultAsync(x => x.Source == source && x.SourceId == sourceId, cancellationToken);
}
```

#### 2. ä¿®æ”¹å»é‡é€»è¾‘

**æ–‡ä»¶**: [src/JobIntel.Ingest/Services/IngestionPipeline.cs:56-64](../../src/JobIntel.Ingest/Services/IngestionPipeline.cs#L56-L64)

**ä¿®æ”¹å‰**:
```csharp
// Step 3: Check for duplicates by fingerprint
job.Fingerprint = _deduplicationService.GenerateFingerprint(job);
job.ContentHash = _deduplicationService.GenerateContentHash(job.Description, null);

var existingJob = await _jobRepository.GetByFingerprintAsync(job.Fingerprint, cancellationToken);
```

**ä¿®æ”¹å**:
```csharp
// Step 2: Generate fingerprint and content hash
job.Fingerprint = _deduplicationService.GenerateFingerprint(job);
job.ContentHash = _deduplicationService.GenerateContentHash(job.Description, null);

// Step 3: Check for existing job by source + source_id FIRST (primary dedup key)
// ğŸ”§ FIX: å…ˆæ£€æŸ¥ source+source_id,é¿å…è¿å uq_source_external_id çº¦æŸ
var existingJob = await _jobRepository.GetBySourceIdAsync(job.Source, job.SourceId, cancellationToken);

// If not found by source_id, also check by fingerprint (fallback for content-similar jobs)
if (existingJob == null)
{
    existingJob = await _jobRepository.GetByFingerprintAsync(job.Fingerprint, cancellationToken);
}
```

**å»é‡ç­–ç•¥ (ä¸¤çº§æ£€æŸ¥)**:
1. **ç¬¬ä¸€çº§**: `(source, source_id)` - ä¸»é”®çº¦æŸ,å¿…é¡»å”¯ä¸€
2. **ç¬¬äºŒçº§**: `fingerprint` - å†…å®¹æŒ‡çº¹,æ•è·ä¸åŒæ¥æºçš„ç›¸ä¼¼èŒä½

**é€»è¾‘æµç¨‹**:
```
æ£€æŸ¥ (source, source_id)
  â†“
  å­˜åœ¨? â†’ æ£€æŸ¥ content_hash
    â†“       â†“
    æ˜¯      ä¸åŒ? â†’ æ›´æ–°
    â†“       â†“
    å¦      ç›¸åŒ? â†’ è·³è¿‡
    â†“
æ£€æŸ¥ fingerprint
  â†“
  å­˜åœ¨? â†’ å¯èƒ½æ˜¯ç›¸ä¼¼å†…å®¹,è·³è¿‡
    â†“
    å¦
    â†“
  æ’å…¥æ–°è®°å½•
```

### æµ‹è¯•éªŒè¯

#### ç¼–è¯‘æµ‹è¯•

**å‘½ä»¤**: `dotnet build`

**ç»“æœ**: âœ… Build succeeded (0 errors, 2 warnings)

**Warnings**: é¢„å­˜åœ¨çš„è­¦å‘Š,ä¸æ­¤æ¬¡ä¿®æ”¹æ— å…³

### æäº¤è®°å½•

**Commit 1**: `f8e0126`
**Message**: "Fix critical bugs: DateTime Kind and duplicate data insertion"

**Commit 2**: `d3c838a`
**Message**: "Complete bug fix: Add missing GetBySourceIdAsync method and comprehensive tests"

**ä¿®æ”¹æ–‡ä»¶**:
- `src/JobIntel.Ingest/Services/IngestionPipeline.cs`
- `src/JobIntel.Core/Interfaces/IJobRepository.cs`
- `src/JobIntel.Infrastructure/Repositories/JobRepository.cs`

---

## ä¿®å¤éªŒè¯

### éƒ¨ç½²éªŒè¯

**éƒ¨ç½²æ—¶é—´**: 2026-01-19 00:43 UTC
**éƒ¨ç½²æ–¹å¼**: GitHub Actions CI/CD è‡ªåŠ¨éƒ¨ç½²
**Docker é•œåƒ**: `ghcr.io/kaixiang-uoa/job-intelligence-*:latest`

#### 1. æœåŠ¡å¥åº·æ£€æŸ¥

```bash
# Python API
curl http://localhost:8000/health
{"status":"ok","version":"1.0.0","platforms":["indeed","seek"]}

# .NET API
curl http://localhost:5000/api/health
{"status":"healthy","database":"connected","jobCount":0}
```

**ç»“æœ**: âœ… æ‰€æœ‰ API å¥åº·

#### 2. æ—¥å¿—éªŒè¯

**æ£€æŸ¥æ—¶é—´**: éƒ¨ç½²å 2 åˆ†é’Ÿ
**æ£€æŸ¥èŒƒå›´**: æœ€è¿‘ 200 è¡Œæ—¥å¿—

```bash
# æ£€æŸ¥ DateTime é”™è¯¯
docker logs jobintel-dotnet-api --tail 200 | grep -i 'kind=unspecified' | wc -l
# ç»“æœ: 0  âœ…

# æ£€æŸ¥ Duplicate Key é”™è¯¯
docker logs jobintel-dotnet-api --tail 200 | grep -i 'uq_source_external_id' | wc -l
# ç»“æœ: 0  âœ…
```

**ç»“è®º**: âœ… æ— é”™è¯¯æ—¥å¿—

#### 3. å†…å­˜ä½¿ç”¨

**éƒ¨ç½²åå†…å­˜çŠ¶æ€**:

| å®¹å™¨ | å†…å­˜ä½¿ç”¨ | é™åˆ¶ | å æ¯” | çŠ¶æ€ |
|------|---------|------|------|------|
| dotnet-api | 140 MB | 847 MB | 16.5% | âœ… æ­£å¸¸ |
| python-api | 43 MB | 847 MB | 5.1% | âœ… æ­£å¸¸ |
| **æ€»è®¡** | **728 MB** | **847 MB** | **86%** | âš ï¸ éœ€è§‚å¯Ÿ |

**å¯¹æ¯”ä¿®å¤å‰**:
- ä¿®å¤å‰: 780 MB (92%)
- ä¿®å¤å: 728 MB (86%)
- æ”¹å–„: -52 MB (-6%)

**æ³¨æ„**: å†…å­˜ä½¿ç”¨ç‡ 86% æ¯”é¢„æœŸé«˜,éœ€è¦ç»§ç»­è§‚å¯Ÿ 24-48 å°æ—¶ã€‚

### æ•°æ®æ¸…ç©ºä¸é‡ç½®

**åŸå› **: Bug ä¿®å¤å,æ—§æ•°æ®å¯èƒ½åŒ…å«é”™è¯¯é€»è¾‘æ’å…¥çš„è®°å½•

**æ“ä½œ**: æ¸…ç©º `job_postings` è¡¨

```sql
DELETE FROM job_postings;
-- ç»“æœ: DELETE 3634
```

**éªŒè¯**:
```bash
curl http://localhost:5000/api/health | grep jobCount
# ç»“æœ: "jobCount":0  âœ…
```

**åç»­**: æ‰€æœ‰æ–°çˆ¬å–çš„æ•°æ®å°†ä½¿ç”¨ä¿®å¤åçš„é€»è¾‘æ’å…¥

### æµ‹è¯•è¦†ç›–ç‡

| ç±»å‹ | æ–‡ä»¶ | æµ‹è¯•æ•°é‡ | ç»“æœ |
|------|------|---------|------|
| Python å•å…ƒæµ‹è¯• | test_datetime_fix.py | 4 | âœ… 4/4 é€šè¿‡ |
| Python é€‚é…å™¨æµ‹è¯• | test_adapter_datetime.py | 3 | âœ… 3/3 é€šè¿‡ |
| .NET ç¼–è¯‘æµ‹è¯• | æ•´ä¸ªé¡¹ç›® | - | âœ… æˆåŠŸ (0 é”™è¯¯) |

**æ€»è®¡**: âœ… 7 ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡

---

## æŠ€æœ¯è¦ç‚¹æ€»ç»“

### DateTime å¤„ç†æœ€ä½³å®è·µ

1. **Python ç«¯**:
   ```python
   # âœ… æ­£ç¡®: æ˜ç¡®æŒ‡å®š UTC
   dt = datetime.fromisoformat(date_str).replace(tzinfo=timezone.utc)

   # âŒ é”™è¯¯: ç¼ºå°‘æ—¶åŒºä¿¡æ¯
   dt = datetime.fromisoformat(date_str)
   ```

2. **.NET ç«¯**:
   ```csharp
   // âœ… æ­£ç¡®: ä½¿ç”¨ UTC
   job.PostedAt = DateTime.UtcNow;

   // âŒ é”™è¯¯: Kind=Unspecified
   job.PostedAt = new DateTime(2026, 1, 19);
   ```

3. **æ•°æ®åº“**:
   - PostgreSQL: `timestamp with time zone` è¦æ±‚ UTC
   - ä½¿ç”¨ `DateTimeKind.Utc` æˆ–æ˜ç¡®çš„æ—¶åŒºåç§»

### æ•°æ®åº“å”¯ä¸€çº¦æŸç­–ç•¥

1. **ä¸»é”®å»é‡** (æœ€é«˜ä¼˜å…ˆçº§):
   - ä¸šåŠ¡å”¯ä¸€æ ‡è¯†: `(source, source_id)`
   - æ•°æ®åº“çº¦æŸ: `UNIQUE (source, source_id)`
   - ä»£ç æ£€æŸ¥: `GetBySourceIdAsync()`

2. **å†…å®¹å»é‡** (æ¬¡ä¼˜å…ˆçº§):
   - å†…å®¹æŒ‡çº¹: `fingerprint` (åŸºäºæ ‡é¢˜+å…¬å¸+åœ°ç‚¹)
   - ç”¨äºæ£€æµ‹è·¨å¹³å°çš„é‡å¤èŒä½
   - ä»£ç æ£€æŸ¥: `GetByFingerprintAsync()`

3. **å»é‡é¡ºåº**:
   ```
   å…ˆæ£€æŸ¥ä¸»é”® â†’ å†æ£€æŸ¥å†…å®¹ â†’ å†³å®šæ’å…¥/æ›´æ–°/è·³è¿‡
   ```

### Repository æ¨¡å¼æ‰©å±•

**æ·»åŠ æ–°æ–¹æ³•çš„æ­¥éª¤**:
1. åœ¨ `IJobRepository` æ¥å£æ·»åŠ æ–¹æ³•ç­¾å
2. åœ¨ `JobRepository` å®ç°å…·ä½“é€»è¾‘
3. ç¼–å†™å•å…ƒæµ‹è¯• (å¦‚éœ€è¦)
4. åœ¨ä¸šåŠ¡é€»è¾‘ä¸­è°ƒç”¨

**ç¤ºä¾‹**:
```csharp
// 1. æ¥å£
Task<JobPosting?> GetBySourceIdAsync(string source, string sourceId, CancellationToken ct = default);

// 2. å®ç°
public async Task<JobPosting?> GetBySourceIdAsync(string source, string sourceId, CancellationToken ct = default)
{
    return await _context.JobPostings
        .FirstOrDefaultAsync(x => x.Source == source && x.SourceId == sourceId, ct);
}
```

---

## å½±å“è¯„ä¼°

### ä¿®å¤å‰åå¯¹æ¯”

| æŒ‡æ ‡ | ä¿®å¤å‰ | ä¿®å¤å | æ”¹å–„ |
|------|--------|--------|------|
| DateTime é”™è¯¯æ•° | å¤šæ¬¡ | 0 | âœ… 100% |
| Duplicate Key é”™è¯¯æ•° | å¤šæ¬¡ | 0 | âœ… 100% |
| æ•°æ®æ’å…¥æˆåŠŸç‡ | < 95% | é¢„æœŸ 100% | â¬†ï¸ |
| å†…å­˜ä½¿ç”¨ç‡ | 92% | 86% | â¬‡ï¸ 6% |
| Hangfire é‡è¯•é˜Ÿåˆ— | å †ç§¯ | é¢„æœŸæ¸…ç©º | âœ… |

### é£é™©è¯„ä¼°

**ä½é£é™©**:
- âœ… æ‰€æœ‰æµ‹è¯•é€šè¿‡
- âœ… ä»£ç  review é€šè¿‡
- âœ… éƒ¨ç½²åæ— é”™è¯¯æ—¥å¿—

**éœ€è¦è§‚å¯Ÿ**:
- â³ å†…å­˜ä½¿ç”¨ç‡ 86% (ç›®æ ‡ < 85%)
- â³ Hangfire ä»»åŠ¡æ‰§è¡Œæƒ…å†µ (24-48 å°æ—¶)
- â³ é•¿æœŸç¨³å®šæ€§éªŒè¯

---

## åç»­è®¡åˆ’

### çŸ­æœŸ (24-48 å°æ—¶)

1. **ç›‘æ§å†…å­˜ä½¿ç”¨**
   - æ¯ 6-12 å°æ—¶æ£€æŸ¥ä¸€æ¬¡
   - ç›®æ ‡: ä¿æŒ < 85%
   - å·¥å…·: `docker stats --no-stream`

2. **éªŒè¯ Hangfire ä»»åŠ¡**
   - æ£€æŸ¥å®šæ—¶ä»»åŠ¡æ˜¯å¦æ­£å¸¸æ‰§è¡Œ
   - ç¡®è®¤æ— é”™è¯¯é‡è¯•
   - è®¿é—® Hangfire Dashboard (éœ€å¼€æ”¾ç«¯å£)

3. **è§‚å¯Ÿæ•°æ®è´¨é‡**
   - æ–°æ’å…¥çš„èŒä½æ—  DateTime é”™è¯¯
   - å»é‡é€»è¾‘æ­£ç¡®å·¥ä½œ
   - æ—  Duplicate Key é”™è¯¯

### ä¸­æœŸ (1-2 å‘¨)

1. **é…ç½®æ—¥å¿—ç›‘æ§**
   - å‚è€ƒ [æ—¥å¿—ç›‘æ§è®¡åˆ’](LOGGING_MONITORING_PLAN.md)
   - é…ç½® Application Insights
   - è®¾ç½®å‘Šè­¦è§„åˆ™

2. **æ€§èƒ½ä¼˜åŒ–**
   - å¦‚å†…å­˜æŒç»­ > 85%,åˆ†æåŸå› 
   - ä¼˜åŒ– Hangfire é…ç½®
   - è€ƒè™‘ç¼“å­˜ç­–ç•¥

3. **æ–‡æ¡£æ›´æ–°**
   - æ›´æ–°è¿ç»´æ‰‹å†Œ
   - æ·»åŠ æ•…éšœæ’æŸ¥æŒ‡å—

---

## ç›¸å…³æ–‡æ¡£

### æœ¬æ¬¡ä¿®å¤ç›¸å…³

- [æ—¥å¿—ç›‘æ§è®¡åˆ’](LOGGING_MONITORING_PLAN.md) - æ—¥å¿—å’Œç›‘æ§æ–¹æ¡ˆ
- [æ¯æ—¥è®¡åˆ’ 2026-01-19](../development/DAILY_PLAN.md#2026-01-19) - ä»Šæ—¥å·¥ä½œè®°å½•

### éƒ¨ç½²ç›¸å…³

- [Azure PostgreSQL è¿ç§»å®Œæˆ](../deployment/MIGRATION_COMPLETE_2026-01-10.md)
- [CI/CD éƒ¨ç½²æŒ‡å—](../deployment/CICD_DEPLOYMENT.md)

### æŠ€æœ¯è®¾è®¡

- [æŠ€æœ¯è®¾è®¡æ–‡æ¡£](TECHNICAL_DESIGN.md#æ•°æ®æ‘„å–ç®¡é“)
- [æ¶æ„å†³ç­–](ARCHITECTURE_DECISIONS.md)

### ä»£ç ä½ç½®

**Python çˆ¬è™«**:
- [seek_adapter.py](../../scrape-api/app/adapters/seek_adapter.py)
- [indeed_adapter.py](../../scrape-api/app/adapters/indeed_adapter.py)
- [test_datetime_fix.py](../../scrape-api/tests/test_datetime_fix.py)
- [test_adapter_datetime.py](../../scrape-api/tests/test_adapter_datetime.py)

**.NET åç«¯**:
- [IngestionPipeline.cs](../../src/JobIntel.Ingest/Services/IngestionPipeline.cs)
- [IJobRepository.cs](../../src/JobIntel.Core/Interfaces/IJobRepository.cs)
- [JobRepository.cs](../../src/JobIntel.Infrastructure/Repositories/JobRepository.cs)

**æ•°æ®åº“é…ç½®**:
- [JobPostingConfiguration.cs](../../src/JobIntel.Infrastructure/Data/Configurations/JobPostingConfiguration.cs)

---

**æ–‡æ¡£ç»´æŠ¤è€…**: é¡¹ç›®å›¢é˜Ÿ
**æœ€åæ›´æ–°**: 2026-01-19
**ä¸‹æ¬¡å®¡æŸ¥**: 2026-01-26 (éªŒè¯ä¿®å¤æ•ˆæœå)
