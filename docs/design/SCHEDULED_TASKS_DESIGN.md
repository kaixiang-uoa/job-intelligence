# å®šæ—¶ä»»åŠ¡è®¾è®¡æ–¹æ¡ˆ

> **åˆ›å»ºæ—¶é—´:** 2025-12-23
> **çŠ¶æ€:** è®¾è®¡é˜¶æ®µ
> **ç›®çš„:** è§„åˆ’ç³»ç»Ÿçš„å®šæ—¶ä»»åŠ¡æ¶æ„ï¼Œæ”¯æŒä» V1 åˆ° V2 çš„æ¸è¿›å¼æ¼”è¿›

---

## ğŸ“‹ ç›®å½•

1. [ä¸šåŠ¡åœºæ™¯åˆ†æ](#ä¸šåŠ¡åœºæ™¯åˆ†æ)
2. [ä¸¤ç§æ¨¡å¼å¯¹æ¯”](#ä¸¤ç§æ¨¡å¼å¯¹æ¯”)
3. [è¡Œä¸šå¸¸è§è®¾è®¡æ¨¡å¼](#è¡Œä¸šå¸¸è§è®¾è®¡æ¨¡å¼)
4. [åˆ†é˜¶æ®µå®æ–½æ–¹æ¡ˆ](#åˆ†é˜¶æ®µå®æ–½æ–¹æ¡ˆ)
5. [æŠ€æœ¯å®ç°ç»†èŠ‚](#æŠ€æœ¯å®ç°ç»†èŠ‚)
6. [æ•°æ®åº“è®¾è®¡](#æ•°æ®åº“è®¾è®¡)
7. [æ€§èƒ½å’Œæˆæœ¬è€ƒè™‘](#æ€§èƒ½å’Œæˆæœ¬è€ƒè™‘)

---

## ä¸šåŠ¡åœºæ™¯åˆ†æ

### æ ¸å¿ƒé—®é¢˜

**å®šæ—¶ä»»åŠ¡çš„ä¸¤ç§ä¸šåŠ¡æ¨¡å¼ï¼š**

1. **ç³»ç»Ÿçº§å®šæ—¶æŠ“å–** - ç³»ç»Ÿåå°è‡ªåŠ¨ç»´æŠ¤æ•°æ®æ± 
2. **ç”¨æˆ·çº§å®šæ—¶æŠ“å–** - ç”¨æˆ·ä¸ªæ€§åŒ–è®¢é˜…å’Œæ¨é€

### å…³é”®å·®å¼‚

| ç»´åº¦ | ç³»ç»Ÿçº§ | ç”¨æˆ·çº§ |
|------|--------|--------|
| **æ•°æ®å½’å±** | æ‰€æœ‰ç”¨æˆ·å…±äº« | æ¯ä¸ªç”¨æˆ·ç‹¬ç«‹ |
| **æŠ“å–ç­–ç•¥** | å›ºå®šï¼ˆçƒ­é—¨ç»„åˆï¼‰ | ä¸ªæ€§åŒ–ï¼ˆç”¨æˆ·å®šä¹‰ï¼‰ |
| **èµ„æºæ¶ˆè€—** | ä½ï¼ˆé›†ä¸­æŠ“å–ï¼‰ | é«˜ï¼ˆåˆ†æ•£æŠ“å–ï¼‰ |
| **é€‚ç”¨åœºæ™¯** | Job board / èšåˆå¹³å° | æ±‚èŒåŠ©æ‰‹ / è®¢é˜…æœåŠ¡ |
| **ç”¨æˆ·ä½“éªŒ** | å³æ—¶æŸ¥è¯¢ | ä¸»åŠ¨æ¨é€ |
| **å¤æ‚åº¦** | ç®€å• | å¤æ‚ï¼ˆéœ€ç”¨æˆ·ç³»ç»Ÿï¼‰ |

---

## ä¸¤ç§æ¨¡å¼å¯¹æ¯”

### æ¨¡å¼ Aï¼šç³»ç»Ÿçº§å®šæ—¶æŠ“å– â­ æ¨èç”¨äº V1

#### ä¸šåŠ¡åœºæ™¯
- ç³»ç»Ÿåå°è‡ªåŠ¨ã€å®šæœŸä» SEEK/Indeed æŠ“å–æœ€æ–°èŒä½
- æ‰€æœ‰ç”¨æˆ·å…±äº«åŒä¸€ä»½æ•°æ®æ± 
- ç”¨æˆ·éšæ—¶æŸ¥è¯¢éƒ½èƒ½çœ‹åˆ°æœ€æ–°æ•°æ®

#### æ•°æ®æµç¨‹
```
ç³»ç»Ÿå®šæ—¶ä»»åŠ¡ï¼ˆæ¯å°æ—¶/æ¯å¤©ï¼‰
    â†“
æŠ“å– SEEK/Indeed æœ€æ–°èŒä½
    â†“
ä¿å­˜åˆ°å…±äº«æ•°æ®åº“ï¼ˆå»é‡ï¼‰
    â†“
æ‰€æœ‰ç”¨æˆ·éƒ½èƒ½æŸ¥è¯¢åˆ°
```

#### ä¼˜ç‚¹ âœ…
- ç®€å•é«˜æ•ˆï¼Œèµ„æºåˆ©ç”¨ç‡é«˜
- æ•°æ®é›†ä¸­ç®¡ç†ï¼Œå»é‡å®¹æ˜“
- ç”¨æˆ·æ— éœ€ç­‰å¾…ï¼ŒæŸ¥è¯¢å³æ—¶
- é€‚åˆå¤§è§„æ¨¡ç”¨æˆ·
- **æ— éœ€ç”¨æˆ·ç³»ç»Ÿå³å¯è¿è¡Œ**

#### ç¼ºç‚¹ âŒ
- æŠ“å–ç­–ç•¥å›ºå®šï¼ˆå…³é”®è¯ã€åœ°åŒºå›ºå®šï¼‰
- æ— æ³•å®Œå…¨ä¸ªæ€§åŒ–ï¼ˆæ¯ä¸ªç”¨æˆ·éœ€æ±‚ä¸åŒï¼‰
- å¯èƒ½æŠ“å–ç”¨æˆ·ä¸éœ€è¦çš„æ•°æ®

#### å…¸å‹åº”ç”¨
- Indeedã€LinkedInã€SEEK ç­‰ Job board
- æˆ¿äº§èšåˆå¹³å°ï¼ˆrealestate.com.auï¼‰
- æ–°é—»èšåˆå¹³å°

---

### æ¨¡å¼ Bï¼šç”¨æˆ·çº§å®šæ—¶æŠ“å– â­ é€‚åˆ V2

#### ä¸šåŠ¡åœºæ™¯
- ç”¨æˆ·ç™»å½•åè®¾ç½®ä¸ªäººæœç´¢æ¡ä»¶ï¼ˆå¦‚ "plumber in Sydney"ï¼‰
- ç³»ç»Ÿä¸ºè¯¥ç”¨æˆ·å®šæ—¶æŠ“å–ç¬¦åˆæ¡ä»¶çš„èŒä½
- ç”¨æˆ·æ”¶åˆ°ä¸ªæ€§åŒ–æ¨é€/æé†’

#### æ•°æ®æµç¨‹
```
ç”¨æˆ·è®¾ç½®è®¢é˜…ï¼š
  - å…³é”®è¯ï¼šplumber
  - åœ°åŒºï¼šSydney
  - è–ªèµ„èŒƒå›´ï¼š> $90k
  - æ¨é€é¢‘ç‡ï¼šæ¯å¤©æ—©ä¸Š 9 ç‚¹

ç³»ç»Ÿä¸ºè¯¥ç”¨æˆ·åˆ›å»ºå®šæ—¶ä»»åŠ¡
    â†“
æ¯å¤© 9 ç‚¹è‡ªåŠ¨æŠ“å–ç¬¦åˆæ¡ä»¶çš„èŒä½
    â†“
ä¿å­˜åˆ°ç”¨æˆ·çš„è®¢é˜…ç»“æœä¸­
    â†“
å‘é€é‚®ä»¶/æ¨é€é€šçŸ¥ç»™ç”¨æˆ·
```

#### ä¼˜ç‚¹ âœ…
- é«˜åº¦ä¸ªæ€§åŒ–
- ç”¨æˆ·ç²˜æ€§å¼ºï¼ˆè®¢é˜…åˆ¶ï¼‰
- å¯ä»¥ç²¾å‡†æ¨é€
- æé«˜ç”¨æˆ·ç•™å­˜ç‡

#### ç¼ºç‚¹ âŒ
- å¤æ‚åº¦é«˜ï¼ˆéœ€è¦ç”¨æˆ·ç³»ç»Ÿã€è®¢é˜…ç®¡ç†ï¼‰
- èµ„æºæ¶ˆè€—å¤§ï¼ˆæ¯ä¸ªç”¨æˆ·å•ç‹¬æŠ“å–ï¼‰
- å¯èƒ½é‡å¤æŠ“å–ç›¸åŒæ•°æ®
- **éœ€è¦å®Œæ•´çš„é€šçŸ¥æœåŠ¡**

#### å…¸å‹åº”ç”¨
- Google Alerts
- æˆ¿äº§è®¢é˜…æé†’ï¼ˆDomain.com.auï¼‰
- LinkedIn Job Alerts

---

## è¡Œä¸šå¸¸è§è®¾è®¡æ¨¡å¼

### 1. LinkedIn / Indeed æ¨¡å¼ï¼ˆæ··åˆæ¶æ„ï¼‰â­ è¡Œä¸šæ ‡å‡†

**ç³»ç»Ÿçº§æŠ“å– + ç”¨æˆ·è®¢é˜…åŒ¹é…**

```
ç¬¬ä¸€å±‚ï¼šç³»ç»Ÿæ¯å°æ—¶æŠ“å–çƒ­é—¨èŒä½ï¼ˆé€šç”¨æ•°æ®æ± ï¼‰
    â†“
ç¬¬äºŒå±‚ï¼šç”¨æˆ·è®¾ç½® Job Alertï¼ˆåŸºäºç°æœ‰æ•°æ®æ± åŒ¹é…ï¼‰
    â†“
ç¬¬ä¸‰å±‚ï¼šé«˜çº§ç”¨æˆ·å¯è§¦å‘å³æ—¶æœç´¢ï¼ˆAPI è°ƒç”¨ï¼‰
```

**æ¶æ„ç‰¹ç‚¹ï¼š**
- âœ… åŸºç¡€æ•°æ®ç”±ç³»ç»Ÿç»Ÿä¸€ç»´æŠ¤ï¼ˆé™ä½æˆæœ¬ï¼‰
- âœ… ç”¨æˆ·è®¢é˜…åŸºäºæ•°æ®åº“æŸ¥è¯¢ï¼Œä¸è§¦å‘å®æ—¶æŠ“å–
- âœ… åªæœ‰ VIP/ä»˜è´¹ç”¨æˆ·æ‰èƒ½è§¦å‘å®æ—¶æŠ“å–
- âœ… å¹³è¡¡äº†æ•ˆç‡å’Œä¸ªæ€§åŒ–

**ä¼˜åŠ¿ï¼š**
- èµ„æºå¯æ§
- ç”¨æˆ·ä½“éªŒå¥½
- å¯æ‰©å±•æ€§å¼º
- é€‚åˆå¤§è§„æ¨¡å•†ä¸šåº”ç”¨

**ç¤ºä¾‹æ•°æ®æµï¼š**
```sql
-- ç³»ç»ŸæŠ“å–ä»»åŠ¡
æ¯å°æ—¶æŠ“å– "software engineer" in Sydney â†’ æ•°æ®åº“

-- ç”¨æˆ·è®¢é˜…
ç”¨æˆ· A è®¢é˜… "software engineer" in Sydney, $120k+
    â†“
æ¯å¤©æ—©ä¸Š 9 ç‚¹ï¼Œä»æ•°æ®åº“æŸ¥è¯¢ç¬¦åˆæ¡ä»¶çš„æ–°èŒä½
    â†“
å‘é€é‚®ä»¶ç»™ç”¨æˆ· A
```

---

### 2. Google Alerts æ¨¡å¼ï¼ˆçº¯ç”¨æˆ·è®¢é˜…ï¼‰

**æ¯ä¸ªç”¨æˆ·åˆ›å»ºè‡ªå·±çš„ Alert**

```
ç”¨æˆ·åˆ›å»º Alertï¼š
  - å…³é”®è¯ï¼š"machine learning engineer"
  - é¢‘ç‡ï¼šæ¯å¤©ä¸€æ¬¡

ç³»ç»Ÿå®šæ—¶ï¼ˆæ¯å¤©ï¼‰ï¼š
    â†“
éå†æ‰€æœ‰ç”¨æˆ·çš„ Alert
    â†“
æ‰§è¡Œæœç´¢/æŠ“å–
    â†“
å‘é€ç»“æœç»™ç”¨æˆ·
```

**ç‰¹ç‚¹ï¼š**
- å®Œå…¨ä¸ªæ€§åŒ–
- éœ€è¦å¼ºå¤§çš„ä»»åŠ¡è°ƒåº¦ç³»ç»Ÿï¼ˆHangfire / Quartzï¼‰
- é€‚åˆä¸­å°è§„æ¨¡ç”¨æˆ·ï¼ˆ< 10,000 ç”¨æˆ·ï¼‰

**èµ„æºè€ƒè™‘ï¼š**
- 10,000 ç”¨æˆ· Ã— æ¯å¤© 1 æ¬¡æŠ“å– = æ¯å¤© 10,000 æ¬¡ API è°ƒç”¨
- éœ€è¦åˆç†çš„é¢‘ç‡é™åˆ¶å’Œæ‰¹å¤„ç†

---

### 3. RSS Feed æ¨¡å¼ï¼ˆç³»ç»Ÿçº§å›ºå®šæŠ“å–ï¼‰

**ç³»ç»Ÿç»´æŠ¤å›ºå®šçš„æ•°æ®æº**

```
ç³»ç»Ÿæ¯å°æ—¶æŠ“å–å›ºå®šæ¥æº
    â†“
ç”¨æˆ·è®¢é˜…æ„Ÿå…´è¶£çš„åˆ†ç±»
    â†“
ç³»ç»Ÿæ¨é€åŒ¹é…çš„æ–°å†…å®¹
```

**ç‰¹ç‚¹ï¼š**
- ç³»ç»ŸæŠ“å–ç­–ç•¥å›ºå®š
- ç”¨æˆ·åªèƒ½åœ¨ç°æœ‰åˆ†ç±»ä¸­é€‰æ‹©
- èµ„æºæ¶ˆè€—æœ€ä½
- é€‚åˆæ–°é—»ã€åšå®¢èšåˆ

---

## åˆ†é˜¶æ®µå®æ–½æ–¹æ¡ˆ

### ç¬¬ä¸€é˜¶æ®µï¼šV1 - ç³»ç»Ÿçº§å®šæ—¶æŠ“å– â­ ç°åœ¨å¯åš

**ç›®æ ‡ï¼š** ä¿è¯æ•°æ®åº“å§‹ç»ˆæœ‰æœ€æ–°èŒä½

**å®æ–½ç­–ç•¥ï¼š**
```
ä¸º 13 ä¸ª trade ç±»å‹åˆ›å»ºå®šæ—¶ä»»åŠ¡
    â†“
æ¯ä¸ª trade æŠ“å–ä¸»è¦åŸå¸‚ï¼ˆSydney, Melbourne, Brisbane, Adelaide, Perthï¼‰
    â†“
æ¯ 6 å°æ—¶è¿è¡Œä¸€æ¬¡
    â†“
æ•°æ®å»é‡åå…¥åº“
```

**ä»»åŠ¡çŸ©é˜µï¼š**
| Trade | åŸå¸‚æ•° | æ¯æ¬¡æŠ“å–é‡ | æ¯æ—¥æ€»é‡ |
|-------|--------|-----------|---------|
| Plumber | 5 | 50 | 1000 |
| Electrician | 5 | 50 | 1000 |
| Carpenter | 5 | 50 | 1000 |
| ... | ... | ... | ... |
| **æ€»è®¡** | **65 ä»»åŠ¡** | **3250** | **13000** |

**é¢„ä¼°æˆæœ¬ï¼š**
- æ¯ 6 å°æ—¶è¿è¡Œä¸€æ¬¡ = æ¯å¤© 4 æ¬¡
- 65 ä¸ªä»»åŠ¡ Ã— 4 æ¬¡/å¤© = **260 æ¬¡æŠ“å–/å¤©**
- æ¯æ¬¡æŠ“å– 50 æ¡ = **13,000 æ¡æ•°æ®/å¤©**
- å»é‡åé¢„è®¡ä¿ç•™ 30% = **çº¦ 4,000 æ¡æ–°èŒä½/å¤©**

**ä»£ç é‡ï¼š** 1-2 å°æ—¶

**ä¼˜ç‚¹ï¼š**
- âœ… ç®€å•ï¼Œæ— éœ€ç”¨æˆ·ç³»ç»Ÿ
- âœ… æ•°æ®æŒç»­æ›´æ–°
- âœ… é€‚åˆ MVP éªŒè¯
- âœ… ç«‹å³å¯ç”¨

**ç¼ºç‚¹ï¼š**
- âŒ è¦†ç›–é¢æœ‰é™ï¼ˆåªæŠ“çƒ­é—¨ç»„åˆï¼‰
- âŒ ä¸å¤Ÿä¸ªæ€§åŒ–

---

### ç¬¬äºŒé˜¶æ®µï¼šV1.5 - ç”¨æˆ·è§¦å‘å¼æœç´¢ï¼ˆå¯é€‰ï¼‰

**ç›®æ ‡ï¼š** å…è®¸ç”¨æˆ·å³æ—¶æœç´¢ç‰¹å®šç»„åˆ

**å®æ–½ç­–ç•¥ï¼š**
```
ç”¨æˆ·è®¿é—®ç½‘ç«™ â†’ è¾“å…¥æœç´¢æ¡ä»¶
    â†“
å‰ç«¯è°ƒç”¨ API: GET /api/ingest/seek?keywords=plumber&location=Sydney
    â†“
åç«¯æ£€æŸ¥æ•°æ®æ–°é²œåº¦ï¼ˆå¦‚æœ < 24 å°æ—¶ï¼Œç›´æ¥è¿”å›æ•°æ®åº“ç»“æœï¼‰
    â†“
å¦‚æœæ•°æ®è¿‡æœŸï¼Œè§¦å‘å³æ—¶æŠ“å–
    â†“
è¿”å›ç»“æœç»™ç”¨æˆ·
```

**ç‰¹ç‚¹ï¼š**
- ç”¨æˆ·ä¸»åŠ¨è§¦å‘
- æŒ‰éœ€æŠ“å–
- æ— éœ€å®šæ—¶ä»»åŠ¡
- åˆ©ç”¨ç¼“å­˜å‡å°‘ API è°ƒç”¨

**é€‚åˆåœºæ™¯ï¼š**
- ç”¨æˆ·é‡å°ï¼ˆ< 1,000ï¼‰
- æŸ¥è¯¢é¢‘ç‡ä½
- å¿«é€ŸéªŒè¯å¸‚åœºéœ€æ±‚

**ç¼“å­˜ç­–ç•¥ï¼š**
```csharp
public async Task<List<JobDto>> SearchJobsAsync(string keywords, string location)
{
    var cacheKey = $"{keywords}_{location}";

    // æ£€æŸ¥ç¼“å­˜
    var cachedResult = await _cache.GetAsync<List<JobDto>>(cacheKey);
    if (cachedResult != null && cachedResult.Age < TimeSpan.FromHours(24))
    {
        return cachedResult.Data;  // è¿”å›ç¼“å­˜
    }

    // ç¼“å­˜è¿‡æœŸï¼Œè§¦å‘æŠ“å–
    var freshData = await _scrapeApiClient.FetchJobsAsync(keywords, location);
    await _cache.SetAsync(cacheKey, freshData, TimeSpan.FromHours(24));

    return freshData;
}
```

---

### ç¬¬ä¸‰é˜¶æ®µï¼šV2 - ç”¨æˆ·è®¢é˜… + Job Alerts ğŸš€ å®Œæ•´åŠŸèƒ½

**ç›®æ ‡ï¼š** æä¾›ä¸ªæ€§åŒ–è®¢é˜…å’Œæ¨é€æœåŠ¡

**åŠŸèƒ½æ¸…å•ï¼š**
1. âœ… ç”¨æˆ·æ³¨å†Œ/ç™»å½•
2. âœ… åˆ›å»ºä¸ªäºº Job Alert
3. âœ… è®¾ç½®æ¨é€é¢‘ç‡ï¼ˆå³æ—¶/æ¯æ—¥/æ¯å‘¨ï¼‰
4. âœ… å¤šæ¸ é“é€šçŸ¥ï¼ˆé‚®ä»¶/æ¨é€/çŸ­ä¿¡ï¼‰
5. âœ… Alert ç®¡ç†ï¼ˆç¼–è¾‘/æš‚åœ/åˆ é™¤ï¼‰
6. âœ… æŸ¥çœ‹æ¨é€å†å²

**å®æ–½ç­–ç•¥ï¼š**
```
ç”¨æˆ·è®¢é˜…åŸºäºæ•°æ®åº“åŒ¹é…ï¼ˆä¸é‡å¤æŠ“å–ï¼‰
    â†“
ç³»ç»Ÿå®šæ—¶æ‰«ææ‰€æœ‰æ´»è·ƒ Alert
    â†“
ä»æ•°æ®åº“æŸ¥è¯¢åŒ¹é…çš„æ–°èŒä½ï¼ˆlast_run_at ä¹‹åçš„ï¼‰
    â†“
å¦‚æœæœ‰æ–°èŒä½ â†’ å‘é€é€šçŸ¥
    â†“
æ›´æ–° last_run_at
```

**ä»£ç é‡ï¼š** 2-3 å¤©

---

## æŠ€æœ¯å®ç°ç»†èŠ‚

### V1 å®ç°ï¼šHangfire å®šæ—¶ä»»åŠ¡

#### 1. åŸºç¡€é…ç½®

**Program.cs / Startup.cs:**
```csharp
// æ·»åŠ  Hangfire æœåŠ¡
builder.Services.AddHangfire(config => config
    .UsePostgreSqlStorage(connectionString)
    .UseSimpleAssemblyNameTypeSerializer()
    .UseRecommendedSerializerSettings());

builder.Services.AddHangfireServer();

// å¯ç”¨ Dashboard
app.UseHangfireDashboard("/hangfire", new DashboardOptions
{
    Authorization = new[] { new MyAuthorizationFilter() }
});
```

#### 2. åˆ›å»ºå®šæ—¶ä»»åŠ¡æœåŠ¡

**IScheduledIngestService.cs:**
```csharp
public interface IScheduledIngestService
{
    Task FetchAndSaveAsync(string trade, string location, int maxResults);
}
```

**ScheduledIngestService.cs:**
```csharp
public class ScheduledIngestService : IScheduledIngestService
{
    private readonly IScrapeApiClient _scrapeApiClient;
    private readonly IIngestionPipeline _ingestionPipeline;
    private readonly ILogger<ScheduledIngestService> _logger;

    public async Task FetchAndSaveAsync(string trade, string location, int maxResults)
    {
        try
        {
            _logger.LogInformation(
                "Scheduled fetch started: trade={Trade}, location={Location}",
                trade, location);

            // 1. ä» SEEK å’Œ Indeed æŠ“å–
            var seekTask = _scrapeApiClient.FetchJobsAsync(
                "seek", new[] { trade }, location, maxResults);
            var indeedTask = _scrapeApiClient.FetchJobsAsync(
                "indeed", new[] { trade }, location, maxResults);

            await Task.WhenAll(seekTask, indeedTask);

            var allJobs = seekTask.Result.Concat(indeedTask.Result).ToList();

            // 2. å¤„ç†å’Œä¿å­˜ï¼ˆå»é‡ï¼‰
            var result = await _ingestionPipeline.ProcessAsync(
                allJobs, "scheduled", CancellationToken.None);

            _logger.LogInformation(
                "Scheduled fetch completed: {Trade} in {Location}, " +
                "{New} new, {Updated} updated, {Duplicates} duplicates",
                trade, location, result.NewCount, result.UpdatedCount, result.DedupedCount);
        }
        catch (Exception ex)
        {
            _logger.LogError(ex,
                "Scheduled fetch failed: trade={Trade}, location={Location}",
                trade, location);
            throw;  // Hangfire ä¼šè‡ªåŠ¨é‡è¯•
        }
    }
}
```

#### 3. æ³¨å†Œå®šæ—¶ä»»åŠ¡

**ScheduledJobsConfig.cs:**
```csharp
public static class ScheduledJobsConfig
{
    public static void ConfigureRecurringJobs()
    {
        var trades = new[]
        {
            "plumber", "electrician", "carpenter", "bricklayer",
            "tiler", "painter", "roofer", "plasterer",
            "glazier", "landscaper", "concreter", "drainer", "gasfitter"
        };

        var cities = new[]
        {
            "Sydney", "Melbourne", "Brisbane", "Adelaide", "Perth"
        };

        foreach (var trade in trades)
        {
            foreach (var city in cities)
            {
                var jobId = $"fetch-{trade}-{city}";

                RecurringJob.AddOrUpdate<IScheduledIngestService>(
                    jobId,
                    service => service.FetchAndSaveAsync(trade, city, 50),
                    Cron.Every(6).Hours(),  // æ¯ 6 å°æ—¶
                    new RecurringJobOptions
                    {
                        TimeZone = TimeZoneInfo.FindSystemTimeZoneById("AUS Eastern Standard Time")
                    });
            }
        }
    }
}
```

**åœ¨ Program.cs ä¸­è°ƒç”¨:**
```csharp
var app = builder.Build();

// é…ç½®å®šæ—¶ä»»åŠ¡
ScheduledJobsConfig.ConfigureRecurringJobs();

app.Run();
```

#### 4. Hangfire Dashboard è®¿é—®

è®¿é—® `http://localhost:5000/hangfire` æŸ¥çœ‹ï¼š
- æ‰€æœ‰å®šæ—¶ä»»åŠ¡åˆ—è¡¨
- ä»»åŠ¡æ‰§è¡Œå†å²
- æˆåŠŸ/å¤±è´¥ç»Ÿè®¡
- æ‰‹åŠ¨è§¦å‘ä»»åŠ¡
- æš‚åœ/æ¢å¤ä»»åŠ¡

---

### V2 å®ç°ï¼šç”¨æˆ·è®¢é˜…ç³»ç»Ÿ

#### 1. æ•°æ®åº“è®¾è®¡

**user_job_alerts è¡¨:**
```sql
CREATE TABLE user_job_alerts (
    id SERIAL PRIMARY KEY,
    user_id INT NOT NULL,
    name VARCHAR(100) NOT NULL,  -- "Plumber jobs in Sydney"

    -- æœç´¢æ¡ä»¶ï¼ˆJSONBï¼‰
    criteria JSONB NOT NULL,
    /* ç¤ºä¾‹ï¼š
    {
        "trade": "plumber",
        "locationState": "NSW",
        "locationSuburb": "Sydney",
        "payMin": 90000,
        "employmentType": "Full Time"
    }
    */

    -- æ¨é€è®¾ç½®
    frequency VARCHAR(20) NOT NULL,  -- immediate, daily, weekly
    notification_channels JSONB,  -- ["email", "push"]

    -- çŠ¶æ€
    is_active BOOLEAN DEFAULT true,

    -- æ—¶é—´æˆ³
    created_at TIMESTAMP NOT NULL DEFAULT NOW(),
    last_run_at TIMESTAMP,

    -- å¤–é”®
    CONSTRAINT fk_user FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE CASCADE
);

CREATE INDEX idx_alerts_user_id ON user_job_alerts(user_id);
CREATE INDEX idx_alerts_active ON user_job_alerts(is_active) WHERE is_active = true;
CREATE INDEX idx_alerts_frequency ON user_job_alerts(frequency);
```

**alert_notifications è¡¨:**
```sql
CREATE TABLE alert_notifications (
    id SERIAL PRIMARY KEY,
    alert_id INT NOT NULL,
    job_id INT NOT NULL,

    -- é€šçŸ¥è¯¦æƒ…
    sent_at TIMESTAMP NOT NULL DEFAULT NOW(),
    channel VARCHAR(20) NOT NULL,  -- email, push, sms
    status VARCHAR(20) NOT NULL,  -- sent, failed, pending
    error_message TEXT,

    -- å¤–é”®
    CONSTRAINT fk_alert FOREIGN KEY (alert_id) REFERENCES user_job_alerts(id) ON DELETE CASCADE,
    CONSTRAINT fk_job FOREIGN KEY (job_id) REFERENCES job_postings(id) ON DELETE CASCADE
);

CREATE INDEX idx_notifications_alert_id ON alert_notifications(alert_id);
CREATE INDEX idx_notifications_sent_at ON alert_notifications(sent_at);
```

#### 2. Alert å¤„ç†æœåŠ¡

**IAlertProcessingService.cs:**
```csharp
public interface IAlertProcessingService
{
    Task ProcessAlertsAsync(string frequency);
}
```

**AlertProcessingService.cs:**
```csharp
public class AlertProcessingService : IAlertProcessingService
{
    private readonly IAlertRepository _alertRepository;
    private readonly IJobRepository _jobRepository;
    private readonly INotificationService _notificationService;
    private readonly ILogger<AlertProcessingService> _logger;

    public async Task ProcessAlertsAsync(string frequency)
    {
        // 1. è·å–æ‰€æœ‰æ´»è·ƒçš„æŒ‡å®šé¢‘ç‡çš„ Alert
        var alerts = await _alertRepository.GetActiveAlertsAsync(frequency);

        _logger.LogInformation(
            "Processing {Count} {Frequency} alerts",
            alerts.Count, frequency);

        foreach (var alert in alerts)
        {
            try
            {
                // 2. ååºåˆ—åŒ–æœç´¢æ¡ä»¶
                var criteria = JsonSerializer.Deserialize<JobSearchCriteria>(alert.Criteria);

                // 3. åªæŸ¥è¯¢è‡ªä¸Šæ¬¡è¿è¡Œä»¥æ¥çš„æ–°èŒä½
                criteria.PostedAfter = alert.LastRunAt ?? DateTime.UtcNow.AddDays(-7);

                // 4. ä»æ•°æ®åº“æŸ¥è¯¢åŒ¹é…çš„èŒä½ï¼ˆä¸è§¦å‘æ–°æŠ“å–ï¼‰
                var result = await _jobRepository.SearchAsync(
                    criteria,
                    page: 1,
                    pageSize: 50,
                    sortBy: "posted_at_desc");

                if (result.Items.Count > 0)
                {
                    // 5. å‘é€é€šçŸ¥
                    await _notificationService.SendAlertNotificationAsync(
                        alert.UserId,
                        alert.Name,
                        result.Items,
                        alert.NotificationChannels);

                    _logger.LogInformation(
                        "Sent {Count} jobs to user {UserId} for alert '{Name}'",
                        result.Items.Count, alert.UserId, alert.Name);
                }

                // 6. æ›´æ–°æœ€åè¿è¡Œæ—¶é—´
                alert.LastRunAt = DateTime.UtcNow;
                await _alertRepository.UpdateAsync(alert);
            }
            catch (Exception ex)
            {
                _logger.LogError(ex,
                    "Failed to process alert {AlertId}", alert.Id);
            }
        }
    }
}
```

#### 3. å®šæ—¶ä»»åŠ¡é…ç½®

**åœ¨ ScheduledJobsConfig.cs ä¸­æ·»åŠ :**
```csharp
// æ¯å¤©æ—©ä¸Š 9 ç‚¹å¤„ç†æ¯æ—¥ Alert
RecurringJob.AddOrUpdate<IAlertProcessingService>(
    "process-daily-alerts",
    service => service.ProcessAlertsAsync("daily"),
    Cron.Daily(9),  // æ¯å¤© 9:00 AM
    new RecurringJobOptions
    {
        TimeZone = TimeZoneInfo.FindSystemTimeZoneById("AUS Eastern Standard Time")
    });

// æ¯å‘¨ä¸€æ—©ä¸Š 9 ç‚¹å¤„ç†æ¯å‘¨ Alert
RecurringJob.AddOrUpdate<IAlertProcessingService>(
    "process-weekly-alerts",
    service => service.ProcessAlertsAsync("weekly"),
    Cron.Weekly(DayOfWeek.Monday, 9),
    new RecurringJobOptions
    {
        TimeZone = TimeZoneInfo.FindSystemTimeZoneById("AUS Eastern Standard Time")
    });

// å³æ—¶ Alert æ¯ 15 åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡
RecurringJob.AddOrUpdate<IAlertProcessingService>(
    "process-immediate-alerts",
    service => service.ProcessAlertsAsync("immediate"),
    Cron.Every(15).Minutes());
```

#### 4. API ç«¯ç‚¹

**AlertsController.cs:**
```csharp
[ApiController]
[Route("api/[controller]")]
[Authorize]  // éœ€è¦ç™»å½•
public class AlertsController : ControllerBase
{
    private readonly IAlertRepository _alertRepository;

    // POST /api/alerts - åˆ›å»º Alert
    [HttpPost]
    public async Task<ActionResult<AlertDto>> CreateAlert(CreateAlertRequest request)
    {
        var userId = GetCurrentUserId();  // ä» JWT token è·å–

        var alert = new UserJobAlert
        {
            UserId = userId,
            Name = request.Name,
            Criteria = JsonSerializer.Serialize(request.Criteria),
            Frequency = request.Frequency,
            NotificationChannels = JsonSerializer.Serialize(request.NotificationChannels),
            IsActive = true,
            CreatedAt = DateTime.UtcNow
        };

        var alertId = await _alertRepository.CreateAsync(alert);

        return Ok(new { alertId, message = "Alert created successfully" });
    }

    // GET /api/alerts - è·å–ç”¨æˆ·çš„æ‰€æœ‰ Alert
    [HttpGet]
    public async Task<ActionResult<List<AlertDto>>> GetMyAlerts()
    {
        var userId = GetCurrentUserId();
        var alerts = await _alertRepository.GetByUserIdAsync(userId);

        return Ok(alerts);
    }

    // PUT /api/alerts/{id} - æ›´æ–° Alert
    [HttpPut("{id}")]
    public async Task<IActionResult> UpdateAlert(int id, UpdateAlertRequest request)
    {
        var userId = GetCurrentUserId();
        var alert = await _alertRepository.GetByIdAsync(id);

        if (alert == null || alert.UserId != userId)
            return NotFound();

        alert.Name = request.Name;
        alert.Criteria = JsonSerializer.Serialize(request.Criteria);
        alert.Frequency = request.Frequency;

        await _alertRepository.UpdateAsync(alert);

        return Ok();
    }

    // DELETE /api/alerts/{id} - åˆ é™¤ Alert
    [HttpDelete("{id}")]
    public async Task<IActionResult> DeleteAlert(int id)
    {
        var userId = GetCurrentUserId();
        var alert = await _alertRepository.GetByIdAsync(id);

        if (alert == null || alert.UserId != userId)
            return NotFound();

        await _alertRepository.DeleteAsync(id);

        return NoContent();
    }

    // POST /api/alerts/{id}/toggle - æš‚åœ/æ¢å¤ Alert
    [HttpPost("{id}/toggle")]
    public async Task<IActionResult> ToggleAlert(int id)
    {
        var userId = GetCurrentUserId();
        var alert = await _alertRepository.GetByIdAsync(id);

        if (alert == null || alert.UserId != userId)
            return NotFound();

        alert.IsActive = !alert.IsActive;
        await _alertRepository.UpdateAsync(alert);

        return Ok(new { isActive = alert.IsActive });
    }
}
```

---

## æ•°æ®åº“è®¾è®¡

### V1 é¢å¤–è¡¨ï¼ˆå¯é€‰ï¼‰

**scheduled_ingest_runs è¡¨:**
```sql
CREATE TABLE scheduled_ingest_runs (
    id SERIAL PRIMARY KEY,
    job_id VARCHAR(100) NOT NULL,  -- "fetch-plumber-sydney"
    trade VARCHAR(50),
    location VARCHAR(100),

    -- æ‰§è¡Œç»“æœ
    started_at TIMESTAMP NOT NULL,
    completed_at TIMESTAMP,
    status VARCHAR(20) NOT NULL,  -- success, failed, running

    -- ç»Ÿè®¡
    jobs_fetched INT DEFAULT 0,
    jobs_new INT DEFAULT 0,
    jobs_updated INT DEFAULT 0,
    jobs_duplicated INT DEFAULT 0,

    -- é”™è¯¯ä¿¡æ¯
    error_message TEXT,

    -- å…ƒæ•°æ®
    hangfire_job_id VARCHAR(100)
);

CREATE INDEX idx_ingest_runs_job_id ON scheduled_ingest_runs(job_id);
CREATE INDEX idx_ingest_runs_started_at ON scheduled_ingest_runs(started_at);
```

**ç”¨é€”ï¼š**
- è¿½è¸ªæ¯æ¬¡å®šæ—¶ä»»åŠ¡çš„æ‰§è¡Œæƒ…å†µ
- ç»Ÿè®¡æŠ“å–æ•ˆç‡
- ç›‘æ§å’Œå‘Šè­¦

---

### V2 å®Œæ•´è¡¨è®¾è®¡

å·²åœ¨ä¸Šé¢ "æŠ€æœ¯å®ç°ç»†èŠ‚ - V2 å®ç°" ä¸­è¯¦ç»†è¯´æ˜ï¼š
- `user_job_alerts` - ç”¨æˆ·è®¢é˜…è¡¨
- `alert_notifications` - æ¨é€å†å²è¡¨

---

## æ€§èƒ½å’Œæˆæœ¬è€ƒè™‘

### V1 ç³»ç»Ÿçº§æŠ“å–

**èµ„æºæ¶ˆè€—ä¼°ç®—ï¼š**

| æŒ‡æ ‡ | æ•°å€¼ | è¯´æ˜ |
|------|------|------|
| å®šæ—¶ä»»åŠ¡æ•° | 65 | 13 trades Ã— 5 cities |
| æ‰§è¡Œé¢‘ç‡ | æ¯ 6 å°æ—¶ | æ¯å¤© 4 æ¬¡ |
| æ¯æ—¥æ€»æŠ“å–æ¬¡æ•° | 260 | 65 Ã— 4 |
| æ¯æ¬¡æŠ“å–é‡ | 50 | SEEK + Indeed |
| æ¯æ—¥æŠ“å–æ€»é‡ | 13,000 | 260 Ã— 50 |
| å»é‡åä¿ç•™ç‡ | 30% | é¢„ä¼° |
| æ¯æ—¥æ–°å¢èŒä½ | ~4,000 | 13,000 Ã— 30% |

**API æˆæœ¬ï¼ˆå¦‚æœæœ‰é™åˆ¶ï¼‰ï¼š**
- SEEK API: 260 æ¬¡/å¤©
- Indeed API: 260 æ¬¡/å¤©ï¼ˆé€šè¿‡ JobSpy æŠ“å–ï¼Œå¯èƒ½è¢«é™åˆ¶ï¼‰

**æ•°æ®åº“å­˜å‚¨ï¼š**
- æ¯æ¡èŒä½ ~2KB
- æ¯å¤©æ–°å¢ 4,000 æ¡ Ã— 2KB = **8 MB/å¤©**
- ä¸€ä¸ªæœˆ = **240 MB**
- ä¸€å¹´ = **2.9 GB**

**ä¼˜åŒ–ç­–ç•¥ï¼š**
1. **æ™ºèƒ½è°ƒåº¦** - ç™½å¤©æ¯ 4 å°æ—¶ï¼Œæ™šä¸Šæ¯ 8 å°æ—¶
2. **ä¼˜å…ˆçº§æŠ“å–** - çƒ­é—¨ç»„åˆä¼˜å…ˆ
3. **å¤±è´¥é‡è¯•** - Hangfire è‡ªåŠ¨é‡è¯•æœºåˆ¶
4. **æ•°æ®æ¸…ç†** - 30 å¤©åå½’æ¡£æ—§èŒä½

---

### V2 ç”¨æˆ·è®¢é˜…

**èµ„æºæ¶ˆè€—ä¼°ç®—ï¼ˆå‡è®¾ 1,000 ç”¨æˆ·ï¼‰ï¼š**

| åœºæ™¯ | ç”¨æˆ·æ•° | æ¯æ—¥æŸ¥è¯¢æ¬¡æ•° | æ€»æŸ¥è¯¢ | è¯´æ˜ |
|------|--------|-------------|--------|------|
| æ¯æ—¥ Alert | 700 | 1 | 700 | åŸºäºæ•°æ®åº“æŸ¥è¯¢ |
| æ¯å‘¨ Alert | 200 | 0.14 | 28 | æ¯å‘¨ä¸€æ¬¡ |
| å³æ—¶ Alert | 100 | 96 | 9,600 | æ¯ 15 åˆ†é’Ÿ |
| **æ€»è®¡** | 1,000 | - | **10,328** | çº¯æ•°æ®åº“æŸ¥è¯¢ |

**å…³é”®ä¼˜åŒ–ï¼š**
- âœ… **ä¸è§¦å‘æ–°æŠ“å–** - åŸºäº V1 çš„æ•°æ®æ± æŸ¥è¯¢
- âœ… **æ‰¹é‡å¤„ç†** - æ¯æ¬¡å¤„ç†å¤šä¸ª Alert
- âœ… **ç´¢å¼•ä¼˜åŒ–** - criteria JSONB å­—æ®µä½¿ç”¨ GIN ç´¢å¼•
- âœ… **ç¼“å­˜ç»“æœ** - ç›¸åŒæ¡ä»¶å…±äº«ç»“æœ

**é€šçŸ¥æˆæœ¬ï¼š**
- é‚®ä»¶ï¼šSendGrid å…è´¹é¢åº¦ 100 emails/day
- æ¨é€ï¼šFirebase å…è´¹
- çŸ­ä¿¡ï¼šTwilio æŒ‰æ¡è®¡è´¹ï¼ˆå¯é€‰ï¼‰

---

### æˆæœ¬å¯¹æ¯”

| æ–¹æ¡ˆ | API è°ƒç”¨ | æ•°æ®åº“æŸ¥è¯¢ | å­˜å‚¨ | é€šçŸ¥ | æ€»æˆæœ¬ |
|------|---------|-----------|------|------|--------|
| V1 ç³»ç»Ÿçº§ | 260/å¤© | ä½ | 8 MB/å¤© | æ—  | **ä½** |
| V2 ç”¨æˆ·çº§ï¼ˆçº¯æŠ“å–ï¼‰ | 10,000/å¤© | ä½ | 20 MB/å¤© | é«˜ | **é«˜** |
| V2 æ··åˆæ¶æ„ | 260/å¤© | 10,000/å¤© | 8 MB/å¤© | ä¸­ | **ä¸­** |

**ç»“è®ºï¼š** V2 æ··åˆæ¶æ„ï¼ˆç³»ç»ŸæŠ“å– + ç”¨æˆ·è®¢é˜…åŒ¹é…ï¼‰æ˜¯æœ€ä¼˜æ–¹æ¡ˆ âœ…

---

## ç›‘æ§å’Œå‘Šè­¦

### V1 ç›‘æ§æŒ‡æ ‡

**Hangfire Dashboard è‡ªå¸¦ï¼š**
- âœ… ä»»åŠ¡æˆåŠŸç‡
- âœ… ä»»åŠ¡å¤±è´¥æ¬¡æ•°
- âœ… å¹³å‡æ‰§è¡Œæ—¶é—´
- âœ… é˜Ÿåˆ—é•¿åº¦

**è‡ªå®šä¹‰ç›‘æ§ï¼ˆå¯é€‰ï¼‰ï¼š**
```csharp
public class IngestMonitoringService
{
    public async Task CheckIngestHealthAsync()
    {
        // æ£€æŸ¥æœ€è¿‘ 1 å°æ—¶å†…æ˜¯å¦æœ‰æˆåŠŸçš„æŠ“å–
        var recentRuns = await _runRepository.GetRecentRunsAsync(TimeSpan.FromHours(1));

        if (!recentRuns.Any(r => r.Status == "success"))
        {
            // å‘é€å‘Šè­¦é‚®ä»¶ç»™ç®¡ç†å‘˜
            await _alertService.SendAdminAlertAsync(
                "Scheduled ingest not running",
                "No successful ingest in the last hour");
        }

        // æ£€æŸ¥å¤±è´¥ç‡
        var failureRate = recentRuns.Count(r => r.Status == "failed") / (double)recentRuns.Count;
        if (failureRate > 0.5)
        {
            await _alertService.SendAdminAlertAsync(
                "High ingest failure rate",
                $"Failure rate: {failureRate:P}");
        }
    }
}
```

### V2 ç›‘æ§æŒ‡æ ‡

**Alert ç³»ç»Ÿå¥åº·åº¦ï¼š**
- å¤„ç†çš„ Alert æ•°é‡
- æˆåŠŸå‘é€çš„é€šçŸ¥æ•°é‡
- å¤±è´¥çš„é€šçŸ¥æ•°é‡
- å¹³å‡å¤„ç†æ—¶é—´

**ç”¨æˆ·å‚ä¸åº¦ï¼š**
- æ´»è·ƒ Alert æ•°é‡
- ç”¨æˆ·æ‰“å¼€é‚®ä»¶ç‡
- ç”¨æˆ·ç‚¹å‡»èŒä½ç‡

---

## æ€»ç»“å’Œå»ºè®®

### æ¨èå®æ–½è·¯çº¿

```
V1ï¼ˆç°åœ¨ï¼‰
    â†“
ç³»ç»Ÿçº§å®šæ—¶æŠ“å–ï¼ˆ1-2 å°æ—¶å®æ–½ï¼‰
    â†“
éªŒè¯æ•°æ®è´¨é‡å’Œç³»ç»Ÿç¨³å®šæ€§
    â†“
V1.5ï¼ˆå¯é€‰ï¼‰
    â†“
ç”¨æˆ·è§¦å‘å¼æœç´¢ï¼ˆæŒ‰éœ€æŠ“å–ï¼‰
    â†“
æ”¶é›†ç”¨æˆ·åé¦ˆ
    â†“
V2ï¼ˆæœªæ¥ 1-2 ä¸ªæœˆï¼‰
    â†“
ç”¨æˆ·è®¢é˜… + Job Alerts
    â†“
å®Œæ•´çš„ä¸ªæ€§åŒ–æœåŠ¡
```

### å…³é”®å†³ç­–ç‚¹

| å†³ç­– | V1 | V2 |
|------|----|----|
| **æŠ“å–ç­–ç•¥** | ç³»ç»Ÿçº§å›ºå®š | åŸºäºæ•°æ®æ± åŒ¹é… |
| **ç”¨æˆ·ç³»ç»Ÿ** | ä¸éœ€è¦ | éœ€è¦ |
| **é€šçŸ¥æœåŠ¡** | ä¸éœ€è¦ | éœ€è¦ |
| **å¤æ‚åº¦** | ä½ | ä¸­ |
| **å¼€å‘æ—¶é—´** | 1-2 å°æ—¶ | 2-3 å¤© |
| **é€‚ç”¨åœºæ™¯** | MVP éªŒè¯ | å•†ä¸šäº§å“ |

### ä¸‹ä¸€æ­¥è¡ŒåŠ¨

1. âœ… **ç«‹å³å®æ–½ V1 ç³»ç»Ÿçº§å®šæ—¶æŠ“å–**
   - ç®€å•é«˜æ•ˆ
   - æ— éœ€ç”¨æˆ·ç³»ç»Ÿ
   - éªŒè¯æŠ€æœ¯å¯è¡Œæ€§

2. â¸ï¸ **V1.5 å¯é€‰ï¼ˆæŒ‰éœ€å†³å®šï¼‰**
   - å¦‚æœç”¨æˆ·é‡å°ï¼Œå¯è·³è¿‡
   - ç›´æ¥è¿›å…¥ V2

3. ğŸš€ **V2 ä½œä¸ºé•¿æœŸç›®æ ‡**
   - åœ¨ V1 ç¨³å®šåå®æ–½
   - æä¾›å·®å¼‚åŒ–ç«äº‰åŠ›

---

**æ–‡æ¡£åˆ›å»ºæ—¶é—´:** 2025-12-23
**ä½œè€…:** Claude Code & User
**çŠ¶æ€:** è®¾è®¡å®Œæˆï¼Œå¾…å®æ–½
**ä¸‹ä¸€æ­¥:** å®æ–½ V1 ç³»ç»Ÿçº§å®šæ—¶æŠ“å–
